<x-page>
	<x-data
		name="subPage"
		defaultValue=""
	></x-data>

	<x-data
		name="pageContent"
		defaultValue=""
	></x-data>

	<x-subscribe
		path="pathData"
		handler="pathChange"
	></x-subscribe>

	<x-flow key="pathChange">
		let currentPath = `/${state.pathData.rest || ''}`;

		// Normalize root path
		if (currentPath === '' || currentPath === '/') {
			currentPath = '/';
		}

		if(currentPath === state.activePath) return;
		// console.log('Path changed!', event);
		console.log('currentPath', currentPath);
		SetData('activePath', currentPath);

		// Transform to fragment path for loading content
		const fragmentPath = currentPath === '/' ? 'fragments/home.html' : `fragments${currentPath}.html`;

		SetData('pageContent', '');
		SetData(
			'pageContent',
			Query({ url: fragmentPath })
		 );
	</x-flow>

	<x-data
		name="pathData"
		route="/framework/#/:rest*"
	></x-data>

	<x-box
		sx:position="absolute"
		sx:top="0"
		sx:left="0"
		sx:display="flex"
		sx:flexDirection="row"
		sx:height="100vh"
		sx:width="100vw"
		class="standardLayoutContainer"
	>
		<x-include
			href="./menu.html"
			sx:background="var(--palettePrimaryMain)"
			sx:width="260px"
			sx:height="100vh"
			sx:flexShrink="0"
		></x-include>

		<x-box
			sx:background="var(--paletteBackgroundDefault)"
			sx:height="100vh"
			sx:flex="1"
			sx:overflow="auto"
			sx:display="flex"
			sx:flexDirection="column"
		>
			<x-box
				sx:display="WHEN global_pageContent THEN none ELSE flex"
				sx:width="100%"
				sx:height="100%"
				sx:background="inherit"
				sx:alignItems="center"
				sx:justifyContent="center"
			>
				<x-box
					sx:width="55px"
					sx:height="55px"
					sx:opacity="0.1"
				>
					<svg
						width="100%"
						height="100%"
						viewBox="0 0 44 44"
						fill="none"
						stroke="var(--palettePrimaryMain)"
					>
						<defs>
							<style>
								@keyframes spin {
									to {
										transform: rotate(360deg);
									}
								}
								@keyframes dash {
									0% {
										stroke-dasharray: 1, 150;
										stroke-dashoffset: 0;
									}
									50% {
										stroke-dasharray: 90, 150;
										stroke-dashoffset: -35;
									}
									100% {
										stroke-dasharray: 90, 150;
										stroke-dashoffset: -124;
									}
								}
								.r {
									transform-origin: 22px 22px;
									animation: spin 1s linear infinite;
								}
								.c {
									stroke-width: 4;
									stroke-linecap: round;
									animation: dash 1.5s ease-in-out infinite;
								}
							</style>
						</defs>
						<g class="r">
							<circle
								class="c"
								cx="22"
								cy="22"
								r="18"
							/>
						</g>
					</svg>
				</x-box>
			</x-box>
			<x-fragment
				contents="global_pageContent"
				showLoading="false"
			></x-fragment>
		</x-box>
	</x-box>
</x-page>
