<x-page>
	<x-data
		name="subPage"
		defaultValue=""
	></x-data>

	<x-data
		name="pageContent"
		defaultValue=""
	></x-data>

	<x-subscribe
		path="pathData"
		handler="pathChange"
	></x-subscribe>

	<x-flow key="pathChange">
		let currentPath = `/${state.pathData.rest || ''}`;

		// Normalize root path
		if (currentPath === '' || currentPath === '/') {
			currentPath = '/';
		}

		if(currentPath === state.activePath) return;
		// console.log('Path changed!', event);
		      console.log('currentPath', currentPath);
		SetData('activePath', currentPath);

		// Transform to fragment path for loading content
		const fragmentPath = currentPath === '/' ? 'fragments/home.html' : `fragments${currentPath}.html`;

		SetData('pageContent', '');
		SetData(
			'pageContent',
			Query({ url: fragmentPath })
		);
	</x-flow>

	<x-data
		name="pathData"
		route="/framework/#/:rest*"
	></x-data>

	<x-box
		sx:position="absolute"
		sx:top="0"
		sx:left="0"
		sx:display="flex"
		sx:flexDirection="row"
		sx:height="100vh"
		sx:width="100vw"
		className="standardLayoutContainer"
		class="standardLayoutContainer"
	>
		<x-include
			href="./menu.html"
			sx:background="var(--palettePrimaryMain)"
			sx:width="260px"
			sx:height="100vh"
			sx:flexShrink="0"
		></x-include>

		<x-box
			sx:background="var(--paletteBackgroundDefault)"
			sx:height="100vh"
			sx:flex="1"
			sx:overflow="auto"
			sx:display="flex"
			sx:flexDirection="column"
		>
			<x-box
				sx:display="WHEN global_pageContent THEN none ELSE flex"
				width="100%"
				height="100%"
				background="inherit"
				alignItems="center"
				justifyContent="center"
			>
				<x-box
					sx:width="55px"
					sx:height="55px"
					sx:backgroundImage="url(/loading.svg)"
					sx:backgroundSize="cover"
					sx:opacity="0.1"
				></x-box>
			</x-box>
			<x-fragment
				contents="global_pageContent"
				showLoading="false"
			></x-fragment>
		</x-box>
	</x-box>
</x-page>
