<x-page>
	<x-data
		name="activePath"
		defaultValue=""
	></x-data>
	<x-data
		name="pathData"
		route="/framework/test/index.html#/:rest*"
	></x-data>
	<x-data
		name="mainContent"
		defaultValue="main"
	></x-data>
	<x-data
		name="menuItems"
		defaultValue="[]"
	></x-data>

	<x-subscribe
		path="pathData"
		handler="onPathChange"
	></x-subscribe>
	<x-flow key="onPathChange">
		const path = state?.pathData?.rest || 'dashboard';
		const currentPath = '/' + path;
		if(state.activePath === currentPath) return;

		console.log('Path changed to:', path);
		fetch(`./pages/${path}.html`).then(x => SetData("mainContent", x.text()));

		console.log(state.menuItems);
		SetState('menuItems', state.menuItems.map(item => ({
			...item,
			variant: item.href === currentPath ? "primary" : "secondary",
			opacity: item.href === currentPath ? "1" : "0.6"
		})));
		SetData('activePath', currentPath);
		Navigate(currentPath);
	</x-flow>

	<div class="app-layout">
		<div style="grid-area: sidebar">
			<x-box
				sx:px="16px"
				sx:background="var(--palettePrimaryNavbar)"
				sx:height="100vh"
				sx:display="flex"
				sx:flexDirection="column"
				sx:gap="12px"
			>
				<x-box
					sx:height="75px"
					sx:display="flex"
					sx:alignItems="center"
				>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 220 75"
					>
						<g transform="matrix(0.77, 0, 0, 0.77, -4.82, 6.42)">
							<path
								d="M 30.108 56.225 C 25.148 56.225 20.934 54.228 17.467 50.233 C 13.956 46.239 12.2 41.411 12.2 35.749 C 12.2 30.087 13.956 25.237 17.467 21.198 C 20.934 17.204 25.148 15.207 30.108 15.207 C 34.19 15.207 37.636 16.304 40.445 18.499 C 43.254 20.65 44.988 23.547 45.646 27.19 L 43.013 27.19 C 42.53 24.469 41.059 22.208 38.601 20.408 C 36.187 18.609 33.356 17.709 30.108 17.709 C 25.895 17.709 22.296 19.465 19.311 22.976 C 16.326 26.531 14.834 30.789 14.834 35.749 C 14.834 40.709 16.326 44.966 19.311 48.521 C 22.296 52.033 25.895 53.789 30.108 53.789 C 33.707 53.789 36.67 52.735 38.996 50.628 C 41.367 48.521 42.706 45.712 43.013 42.201 L 45.646 42.201 C 45.295 46.458 43.693 49.86 40.84 52.406 C 38.031 54.952 34.453 56.225 30.108 56.225 Z M 52.743 55.237 L 50.11 55.237 L 50.11 16.195 L 52.743 16.195 L 52.743 55.237 Z M 62.805 55.237 L 60.171 55.237 L 60.171 27.19 L 62.805 27.19 L 62.805 55.237 Z M 60.171 20.211 L 60.171 16.195 L 62.805 16.195 L 62.805 20.211 L 60.171 20.211 Z M 81.029 56.225 C 77.254 56.225 74.226 54.864 71.943 52.143 C 69.661 49.378 68.52 45.734 68.52 41.213 C 68.52 36.692 69.661 33.049 71.943 30.284 C 74.226 27.563 77.254 26.202 81.029 26.202 C 84.804 26.202 87.832 27.453 90.115 29.955 C 92.397 32.457 93.538 35.793 93.538 39.962 L 93.538 41.213 L 71.153 41.213 C 71.153 45.032 72.053 48.082 73.852 50.365 C 75.652 52.648 78.044 53.789 81.029 53.789 C 83.268 53.789 85.287 53.196 87.086 52.011 C 88.929 50.782 90.202 49.18 90.905 47.205 L 93.538 47.205 C 93.099 49.794 91.695 51.945 89.324 53.657 C 86.954 55.369 84.189 56.225 81.029 56.225 Z M 71.153 38.712 L 90.905 38.712 L 90.905 37.724 C 90.685 35.134 89.631 32.939 87.744 31.14 C 85.813 29.385 83.574 28.507 81.029 28.507 C 78.483 28.507 76.266 29.407 74.379 31.206 C 72.448 33.049 71.372 35.31 71.153 37.987 L 71.153 38.712 Z M 101.361 55.237 L 98.727 55.237 L 98.727 27.19 L 101.361 27.19 L 101.361 31.93 C 102.151 30.262 103.358 28.945 104.982 27.98 C 106.606 26.971 108.405 26.466 110.38 26.466 C 113.145 26.466 115.494 27.366 117.425 29.165 C 119.4 31.008 120.388 33.203 120.388 35.749 L 120.388 55.237 L 117.754 55.237 L 117.754 35.749 C 117.754 33.818 117.03 32.172 115.582 30.811 C 114.133 29.45 112.399 28.77 110.38 28.77 C 108.185 28.77 106.232 29.516 104.521 31.008 C 102.809 32.545 101.756 34.454 101.361 36.736 L 101.361 55.237 Z M 132.884 56.225 C 131.436 56.225 130.185 55.632 129.132 54.447 C 128.122 53.306 127.617 51.901 127.617 50.233 L 127.617 29.231 L 123.601 29.231 L 123.601 27.19 L 127.617 27.19 L 127.617 19.223 L 130.251 19.223 L 130.251 27.19 L 134.07 27.19 L 134.07 29.231 L 130.251 29.231 L 130.251 50.233 C 130.251 51.33 130.536 52.274 131.107 53.064 C 131.634 53.854 132.292 54.249 133.082 54.249 C 133.916 54.249 134.596 54.096 135.123 53.789 L 135.123 55.698 C 134.157 56.049 133.411 56.225 132.884 56.225 Z"
								style="fill: var(--palettePrimaryDark)"
							></path>
							<path
								d="M 149.419 55.625 L 146.785 55.625 L 146.785 16.583 L 149.419 16.583 L 149.419 55.625 Z M 159.479 55.625 L 156.845 55.625 L 156.845 27.578 L 159.479 27.578 L 159.479 32.318 C 160.269 30.65 161.476 29.333 163.1 28.368 C 164.724 27.358 166.523 26.854 168.499 26.854 C 171.264 26.854 173.612 27.753 175.543 29.553 C 177.518 31.396 178.506 33.591 178.506 36.137 L 178.506 55.625 L 175.873 55.625 L 175.873 36.137 C 175.873 34.205 175.148 32.559 173.7 31.199 C 172.251 29.838 170.517 29.158 168.499 29.158 C 166.304 29.158 164.351 29.904 162.639 31.396 C 160.927 32.932 159.873 34.842 159.479 37.124 L 159.479 55.625 Z M 196.862 56.876 C 193.175 56.876 190.037 55.383 187.447 52.399 C 184.857 49.414 183.563 45.815 183.563 41.601 C 183.563 37.475 184.857 33.942 187.447 31.001 C 190.037 28.06 193.175 26.59 196.862 26.59 C 199.89 26.59 202.48 27.49 204.631 29.29 C 206.781 31.133 207.857 33.327 207.857 35.873 L 205.224 35.873 C 205.224 34.029 204.412 32.449 202.788 31.133 C 201.164 29.816 199.188 29.158 196.862 29.158 C 193.921 29.158 191.397 30.365 189.291 32.779 C 187.228 35.237 186.197 38.177 186.197 41.601 C 186.197 45.112 187.228 48.119 189.291 50.621 C 191.397 53.123 193.921 54.374 196.862 54.374 C 199.144 54.374 201.076 53.693 202.656 52.333 C 204.28 50.972 205.092 49.348 205.092 47.461 L 207.857 47.461 C 207.857 50.051 206.781 52.267 204.631 54.111 C 202.48 55.954 199.89 56.876 196.862 56.876 Z"
								style="fill: var(--paletteSecondaryDark)"
							></path>
						</g>
					</svg>
				</x-box>
				<x-box
					sx:display="flex"
					sx:flexDirection="column"
					sx:gap="8px"
				>
					<x-map items="global_menuItems">
						<x-button
							href="{{item_href}}"
							variant="{{item_variant}}"
							sx:justifyContent="flex-start"
							sx:opacity="{{item_opacity}}"
							fullWidth
						>
							{{ item_label }}
						</x-button>
					</x-map>
				</x-box>
			</x-box>
		</div>
		<div style="grid-area: main; overflow-y: auto">
			<x-fragment contents="global_mainContent"></x-fragment>
		</div>
	</div>
</x-page>
